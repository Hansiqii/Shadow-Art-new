æˆ‘ä»”ç»†æ£€æŸ¥äº†ä½ çš„ä»£ç ï¼Œå‘ç°äº†å‡ ä¸ªå¯èƒ½å¯¼è‡´è¾“å‡ºç©ºç™½çš„å…³é”®é—®é¢˜ï¼š

## ğŸ”´ ä¸»è¦é—®é¢˜

### 1. **å…‰çº¿æˆªæ–­é—®é¢˜ (train_model_functions.py)**

```python
def truncate_ray(ray):
    # åªä½¿ç”¨äº† cond1ï¼Œå®Œå…¨å¿½ç•¥äº† cond2
    valid_indexes = cond1  # âš ï¸ è¿™é‡Œåªæ£€æŸ¥ z åæ ‡ï¼
    return ray[valid_indexes], valid_indexes
```

**é—®é¢˜**ï¼šä½ æŠŠ `cond2_1`, `cond2_2`, `cond2_3`, `cond2_4` éƒ½æ³¨é‡Šæ‰äº†ï¼Œå¯¼è‡´åªæ£€æŸ¥ z åæ ‡åœ¨ [-0.5, 0.5] èŒƒå›´å†…ï¼Œä½† **æ²¡æœ‰æ£€æŸ¥ x, y åæ ‡**ã€‚è¿™ä¼šè®©å¾ˆå¤šæ— æ•ˆçš„å…‰çº¿ç‚¹å‚ä¸è®¡ç®—ï¼Œå¯èƒ½å¯¼è‡´ï¼š

- å…‰çº¿é‡‡æ ·ç‚¹å¤§é‡è¶…å‡ºæœ‰æ•ˆåŒºåŸŸ
- æ¢¯åº¦è®¡ç®—ä¸å‡†ç¡®
- æ¨¡å‹å­¦ä¹ åˆ°é”™è¯¯çš„å ç”¨åœº

------

### 2. **ç´¯ç§¯å ç”¨ç‡è®¡ç®—é”™è¯¯ (painter.py)**

```python
# åœ¨ project_network2d_row ä¸­
cumprod_result = torch.cumprod(1 - occupancy_values_on_ray, dim=0)
if cumprod_result.size(0) == 0:
    estimate_occupancy = 0
else:
    estimate_occupancy = 1 - cumprod_result[-1]  # âš ï¸ è¿™é‡Œç»´åº¦ä¸å¯¹ï¼
```

**é—®é¢˜**ï¼š

- `occupancy_values_on_ray` çš„ shape åº”è¯¥æ˜¯ `(n_points, batch_size, 1)` æˆ–ç±»ä¼¼
- ä½ æ²¿ç€ `dim=0` ç´¯ä¹˜ï¼Œä½†å– `[-1]` åªä¼šå¾—åˆ°æœ€åä¸€ä¸ªç‚¹çš„å€¼
- åº”è¯¥æ²¿ç€å…‰çº¿æ–¹å‘ï¼ˆæ¯æ¡å…‰çº¿ï¼‰ç´¯ä¹˜ï¼Œè€Œä¸æ˜¯è·¨ä¸åŒå…‰çº¿

**æ­£ç¡®åšæ³•**ï¼š

```python
# åº”è¯¥æ˜¯è¿™æ ·ï¼ˆæ¯æ¡å…‰çº¿ç‹¬ç«‹è®¡ç®—ï¼‰
cumprod_result = torch.cumprod(1 - occupancy_values_on_ray, dim=1)  # dim=1 æ˜¯å…‰çº¿æ–¹å‘
estimate_occupancy = 1 - cumprod_result[:, -1, :]  # æ¯æ¡å…‰çº¿çš„æœ€åä¸€ä¸ªå€¼
```

------

### 3. **æ•°æ®é›†å…‰çº¿ç”Ÿæˆé€»è¾‘æ··ä¹± (RaySamplingDataset.py)**

```python
def generate_sampling_ray_splits(self, r, c, angle, screen, n, img_idx, 
                                  width_3d_rectangle=1, distance_from_center=0.5):
    # è®¡ç®—äº†ä¸¤ç§æ–¹æ³•ï¼Œä½†æ³¨é‡Šæ‰äº†æ–¹æ³•2
    fix_distance = distance_from_center / torch.dot(screen, angle)
    image_center = -angle * fix_distance
```

**æ½œåœ¨é—®é¢˜**ï¼š

- `torch.dot(screen, angle)` å¯èƒ½éå¸¸å°ç”šè‡³æ¥è¿‘ 0ï¼ˆå½“å…‰çº¿å’Œå±å¹•æ¥è¿‘å‚ç›´æ—¶ï¼‰
- è¿™ä¼šå¯¼è‡´ `fix_distance` çˆ†ç‚¸ï¼Œ`image_center` è·‘åˆ°æ— ç©·è¿œ
- éœ€è¦æ·»åŠ å®‰å…¨æ£€æŸ¥ï¼š

```python
dot_product = torch.dot(screen, angle).clamp(min=1e-6)  # é˜²æ­¢é™¤é›¶
```

------

### 4. **æ¨¡å‹åˆå§‹åŒ–å¯èƒ½å¤ªä¿å®ˆ**

```python
def initialize_weights(self):
    for m in self.modules():
        if isinstance(m, nn.Linear):
            nn.init.xavier_uniform_(m.weight)
            nn.init.zeros_(m.bias)
    nn.init.constant_(self.fc8.bias, 0.0)  # è¾“å‡ºå±‚ bias=0
```

**é—®é¢˜**ï¼š

- æœ€åä¸€å±‚ `fc8` bias åˆå§‹åŒ–ä¸º 0ï¼Œç»è¿‡ `sigmoid(0) = 0.5`
- ä½†ä½ çš„æŸå¤±å‡½æ•°æœŸæœ›åˆå§‹è¾“å‡ºæ¥è¿‘ **çœŸå®å½±å­åˆ†å¸ƒ**
- å¦‚æœå¤§éƒ¨åˆ†åƒç´ æ˜¯ç™½è‰²ï¼ˆoccupancy=0ï¼‰ï¼Œæ¨¡å‹ä¼šæŒç»­è¾“å‡º 0.5ï¼ŒæŸå¤±å¾ˆéš¾ä¸‹é™

**å»ºè®®**ï¼š

```python
# æ ¹æ®æ•°æ®é›†ç»Ÿè®¡ï¼Œåˆå§‹åŒ–ä¸ºåˆç†çš„å…ˆéªŒ
nn.init.constant_(self.fc8.bias, -2.0)  # sigmoid(-2) â‰ˆ 0.12
```

------

### 5. **æ­£åˆ™åŒ–é¡¹å¯èƒ½å‹åˆ¶ä¸»æŸå¤±**

```python
loss = 2 * (beta_1 * reg1 + beta_2 * reg2 + ... + img_loss + ...)
```

**é—®é¢˜**ï¼š

- ä½ æŠŠæ‰€æœ‰æŸå¤±ä¹˜ä»¥ 2ï¼Œä½†å„ä¸ª beta ç³»æ•°åœ¨ä¸åŒ epoch ä¼šæŒ‡æ•°å¢é•¿ï¼š
  - `beta_1 * 2^min(epoch, 3)` åœ¨ç¬¬ 3 è½®åå˜æˆ 8 å€
  - `beta_5 * 2^epoch` åœ¨ç¬¬ 10 è½®å˜æˆ 1024 å€ï¼
- æ­£åˆ™åŒ–é¡¹å¯èƒ½å®Œå…¨å‹åˆ¶ `img_loss`ï¼Œå¯¼è‡´æ¨¡å‹åªå­¦ä¹ åˆ°"å¹³æ»‘çš„ç©ºåœºæ™¯"

**å»ºè®®æ£€æŸ¥**ï¼š

```python
# æ‰“å°å„é¡¹æŸå¤±çš„æ¯”ä¾‹
print(f"img_loss: {img_loss:.4f}")
print(f"total_reg: {(beta_1*reg1 + beta_2*reg2 + ...).item():.4f}")
```

------

### 6. **Eikonal æ­£åˆ™åŒ–å¯èƒ½æŠ‘åˆ¶è¡¨é¢**

```python
def regularization_loss_term_eikonal_surface_aware(dataset, model, ray, threshold_ratio=0.4):
    threshold = threshold_ratio * dataset.width / 2.0
    surface_mask = gradient_norms > threshold
    
    if not surface_mask.any():
        return torch.tensor(0.0, device=ray.device)  # âš ï¸ æ²¡æœ‰è¡¨é¢æ—¶è¿”å› 0
```

**é—®é¢˜**ï¼š

- å¦‚æœæ¨¡å‹åˆå§‹åŒ–æ—¶æ¢¯åº¦å¾ˆå°ï¼Œ`surface_mask` å…¨ä¸º False
- Eikonal loss æŒç»­ä¸º 0ï¼Œä¸æä¾›ä»»ä½•çº¦æŸ
- æ¨¡å‹å¯èƒ½é™·å…¥"ä½æ¢¯åº¦å¹³å¦è§£"ï¼ˆå…¨éƒ¨è¾“å‡ºæ¥è¿‘ 0.5ï¼‰

------

## ğŸ”§ å»ºè®®çš„è°ƒè¯•æ­¥éª¤

### Step 1: æ£€æŸ¥å…‰çº¿æ˜¯å¦æ­£ç¡®

```python
# åœ¨ train_loop å¼€å§‹æ—¶æ·»åŠ 
print("Ray range:", rays.min().item(), rays.max().item())
print("Truncated ratio:", valid_indexes.sum() / len(valid_indexes))
```

### Step 2: ä¿®å¤ truncate_ray

```python
def truncate_ray(ray):
    tolerance = 1e-6
    
    # z åæ ‡çº¦æŸ
    cond1 = (ray[:, 2] <= 0.5 + tolerance) & (ray[:, 2] >= -0.5 - tolerance)
    
    # x, y åæ ‡çº¦æŸï¼ˆè‡³å°‘å¯ç”¨ä¸€ä¸ªç®€å•çš„ï¼‰
    cond2 = (ray[:, 0].abs() <= 0.5 + tolerance) & (ray[:, 1].abs() <= 0.5 + tolerance)
    
    valid_indexes = cond1 & cond2  # âœ… åŒæ—¶æ£€æŸ¥
    return ray[valid_indexes], valid_indexes
```

### Step 3: æ£€æŸ¥æŸå¤±å¹³è¡¡

```python
# åœ¨ train_loop çš„æ‰“å°éƒ¨åˆ†æ·»åŠ 
print(f"Loss ratio: img={img_loss:.3f} vs reg={sum([reg1, reg2, ...]):.3f}")
```

### Step 4: é™ä½æ­£åˆ™åŒ–ç³»æ•°

```python
# åœ¨ main.py ä¸­
beta_eikonal=1e-5,  # ä» 1e-4 é™åˆ° 1e-5
beta_6=5e-5,        # å‡å°æ›²ç‡æ­£åˆ™åŒ–
```

### Step 5: å¯è§†åŒ–ä¸­é—´ç»“æœ

```python
# åœ¨ç¬¬ 1 ä¸ª epoch ç»“æŸå
with torch.no_grad():
    sample_occupancy = model(torch.randn(1000, 3).cuda() * 0.5)
    print("Occupancy stats:", sample_occupancy.mean(), sample_occupancy.std())
```

------

## ğŸ¯ æœ€å¯èƒ½çš„åŸå› 

æ ¹æ®ä»£ç ç»“æ„ï¼Œ**æœ€å¯èƒ½çš„é—®é¢˜æ˜¯**ï¼š

1. **å…‰çº¿æˆªæ–­å¤±æ•ˆ** â†’ å¤§é‡æ— æ•ˆç‚¹å‚ä¸è®­ç»ƒ â†’ æ¨¡å‹å­¦ä¹ æ··ä¹±
2. **æ­£åˆ™åŒ–è¿‡å¼º** â†’ æ¨¡å‹è¢«è¿«è¾“å‡ºæ¥è¿‘ 0ï¼ˆç©ºåœºæ™¯ï¼‰æ¥æœ€å°åŒ–å¹³æ»‘æŸå¤±
3. **ç´¯ç§¯å ç”¨ç‡è®¡ç®—é”™è¯¯** â†’ æ¸²æŸ“ç»“æœä¸çœŸå®å€¼æ— å…³ â†’ æŸå¤±æ— æ³•ä¸‹é™

å»ºè®®ä¼˜å…ˆä¿®å¤ `truncate_ray` å’Œæ£€æŸ¥æŸå¤±å¹³è¡¡ï¼













çœ‹åˆ°è¿™äº›æŸå¤±æ›²çº¿ï¼Œé—®é¢˜éå¸¸æ˜æ˜¾äº†ï¼è¿™æ˜¯**å…¸å‹çš„è®­ç»ƒå®Œå…¨å¤±è´¥**çš„ç—‡çŠ¶ï¼š

## ğŸ”´ æ ¸å¿ƒé—®é¢˜è¯Šæ–­

### 1. **Figure Loss å¡åœ¨ 0.704 å®Œå…¨ä¸åŠ¨**

```
Average Figure Loss â‰ˆ 1.08 (ä»å›¾1)
Real Figure Loss â‰ˆ 0.704 (ä»å›¾4)
```

**è¿™æ„å‘³ç€**ï¼š

- æ¨¡å‹çš„é¢„æµ‹ä¸çœŸå®å½±å­å›¾**å®Œå…¨æ— å…³**
- æŸå¤±å€¼æ¥è¿‘éšæœºçŒœæµ‹çš„æ°´å¹³ï¼ˆMSE åœ¨ [0,1] èŒƒå›´å†…çº¦ä¸º 0.5-0.7ï¼‰
- **æ¨¡å‹æ ¹æœ¬æ²¡æœ‰å­¦åˆ°ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯**

------

### 2. **æ‰€æœ‰æŸå¤±éƒ½æ˜¯å¹³ç›´çº¿ = æ¢¯åº¦æ¶ˆå¤±**

è§‚å¯Ÿå›¾è¡¨ï¼š

- **è“è‰² Average Loss**: 2.15 â†’ 2.15 ï¼ˆ30è½®å®Œå…¨ä¸å˜ï¼‰
- **æ©™è‰² Figure Loss**: 1.08 â†’ 1.08 ï¼ˆå®Œå…¨ä¸å˜ï¼‰
- **ç»¿è‰² Reg1**: æ¥è¿‘ 0
- **çº¢è‰² Reg2**: æ¥è¿‘ 0
- **æ›²ç‡æŸå¤±**: å®Œå…¨ä¸º 0

**è¿™è¯´æ˜**ï¼š

1. æ¨¡å‹å‚æ•°**å‡ ä¹æ²¡æœ‰æ›´æ–°**
2. åå‘ä¼ æ’­çš„æ¢¯åº¦**æ¥è¿‘é›¶**æˆ–è¢«**è£å‰ª/å½’ä¸€åŒ–æ‰äº†**
3. ä¼˜åŒ–å™¨å¯èƒ½é™·å…¥äº†**éç‚¹**æˆ–**ç—…æ€çš„æŸå¤±æ™¯è§‚**

------

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

ç»“åˆä»£ç å’ŒæŸå¤±æ›²çº¿ï¼Œæˆ‘æ‰¾åˆ°äº†**æœ€è‡´å‘½çš„ BUG**ï¼š

### **è‡´å‘½é”™è¯¯ 1: `accumulated_occupancy` ç»´åº¦å´©æºƒ**

åœ¨ `train_model_functions.py`:

```python
def accumulated_occupancy(occupancy_values_on_ray):
    cumprod_result = torch.cumprod(1-occupancy_values_on_ray, dim=0)
    if cumprod_result.size(0) == 0:
        return 0
    else:
        return 1-cumprod_result[-1]  # âš ï¸ è¿™é‡Œè¿”å›çš„æ˜¯æ ‡é‡ï¼
```

**é—®é¢˜**ï¼š

- è¾“å…¥ `occupancy_values_on_ray` å½¢çŠ¶æ˜¯ `(n_points, 1)`
- `cumprod` æ²¿ `dim=0` è®¡ç®—ï¼Œå¾—åˆ° `(n_points, 1)`
- `cumprod_result[-1]` å–çš„æ˜¯ `(1,)` å½¢çŠ¶çš„å¼ é‡
- ä½†ä½ åœ¨ `train_loop` ä¸­éœ€è¦çš„æ˜¯**æ¯æ¡å…‰çº¿çš„ç´¯ç§¯å ç”¨ç‡**

åœ¨ `train.py` çš„ `train_loop`:

```python
for ray_id, ray in enumerate(rays):
    # ...
    accumulated_occupancy = train_model_functions.accumulated_occupancy(
        occupancy_values_on_ray
    )
    occupancy_estimation[ray_id] = accumulated_occupancy  # âš ï¸ èµ‹å€¼ç»™å•ä¸ªå…ƒç´ 
```

**å¯¼è‡´çš„åæœ**ï¼š

- å¦‚æœ `accumulated_occupancy` è¿”å›çš„æ˜¯ `(1,)` å½¢çŠ¶ï¼Œèµ‹å€¼æ—¶å¯èƒ½å¹¿æ’­é”™è¯¯
- æˆ–è€…å®é™…ä¸Šåªè®¡ç®—äº†**å…‰çº¿ä¸Šæœ€åä¸€ä¸ªç‚¹**çš„å ç”¨ç‡ï¼Œè€Œä¸æ˜¯æ•´æ¡å…‰çº¿çš„ä¼ æ’­ç»“æœ

------

### **è‡´å‘½é”™è¯¯ 2: `painter.py` ä¸­çš„ç´¯ç§¯å ç”¨ç‡è®¡ç®—é”™è¯¯**

```python
def project_network2d_row(img_idx, row, width, model, dataset, reduce=torch.max):
    # ...
    with torch.no_grad():
        occupancy_values_on_ray = model(rays)  # å½¢çŠ¶: (n_rays, n_points, 1)
        
        # âš ï¸ è¿™é‡Œçš„è®¡ç®—å®Œå…¨é”™è¯¯ï¼
        cumprod_result = torch.cumprod(1 - occupancy_values_on_ray, dim=0)
        if cumprod_result.size(0) == 0:
            estimate_occupancy = 0
        else:
            estimate_occupancy = 1 - cumprod_result[-1]  # å–æœ€åä¸€è¡Œï¼Ÿ
```

**æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯**ï¼š

```python
# rays çš„å½¢çŠ¶æ˜¯ (width, n_points, 1)
occupancy_values_on_ray = model(rays)  # (width*n_points, 1)
occupancy_values_on_ray = occupancy_values_on_ray.view(width, n_points, 1)

# æ²¿ç€æ¯æ¡å…‰çº¿ï¼ˆdim=1ï¼‰ç´¯ä¹˜
cumprod_result = torch.cumprod(1 - occupancy_values_on_ray, dim=1)  
estimate_occupancy = 1 - cumprod_result[:, -1, 0]  # (width,)
```

------

### **è‡´å‘½é”™è¯¯ 3: æŸå¤±è®¡ç®—é”™è¯¯å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±**

åœ¨ `train_loop`:

```python
img_loss = loss_fn(occupancy_estimation, occupancy_values)
img_loss = img_loss * ratio  # ratio æ˜¯é¢ç§¯ä¿®æ­£ç³»æ•°
```

**æ£€æŸ¥ç‚¹**ï¼š

- `occupancy_estimation` çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
- `occupancy_values` çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
- `ratio` æ˜¯å¤šå°‘ï¼Ÿ

**å¾ˆå¯èƒ½çš„æƒ…å†µ**ï¼š

- `occupancy_estimation` å…¨æ˜¯ `0.5`ï¼ˆæ¨¡å‹åˆå§‹åŒ–è¾“å‡ºï¼‰
- `occupancy_values` å¤§éƒ¨åˆ†æ˜¯ `0`ï¼ˆç™½è‰²èƒŒæ™¯ï¼‰
- MSE Loss = `(0.5 - 0)^2 = 0.25`ï¼Œå¹³å‡åçº¦ä¸º **0.7**ï¼ˆä¸ä½ çš„å›¾4ä¸€è‡´ï¼ï¼‰
- ä½†ç”±äºæ¢¯åº¦ä¼ æ’­è·¯å¾„æ–­è£‚ï¼ŒæŸå¤±æ— æ³•å›ä¼ 

------

## ğŸ”§ ç´§æ€¥ä¿®å¤æ–¹æ¡ˆ

### **ä¿®å¤ 1: ä¿®æ­£ `accumulated_occupancy`**

```python
def accumulated_occupancy(occupancy_values_on_ray):
    """
    Params: occupancy_values_on_ray: (n_points, 1) æˆ– (n_points,)
    Returns: æ ‡é‡ï¼Œå…‰çº¿çš„ç´¯ç§¯å ç”¨ç‡
    """
    if occupancy_values_on_ray.numel() == 0:
        return torch.tensor(0.0, device=occupancy_values_on_ray.device)
    
    # ç¡®ä¿æ˜¯ 1D å¼ é‡
    occ = occupancy_values_on_ray.squeeze()
    
    # ç´¯ä¹˜ (1 - occ)
    cumprod_result = torch.cumprod(1 - occ, dim=0)
    
    # è¿”å›æ ‡é‡
    return 1 - cumprod_result[-1]
```

------

### **ä¿®å¤ 2: ä¿®æ­£ `train_loop` ä¸­çš„æ‰¹é‡å¤„ç†**

```python
# åœ¨ train_loop ä¸­
occupancy_estimation = torch.zeros(len(rays), dtype=torch.float32, device=device)

for ray_id, ray in enumerate(rays):
    if ray.size(0) == 0:
        continue

    # å‰å‘ä¼ æ’­
    occupancy_values_on_whole_ray = model(ray)  # (n_points, 1)
    
    # æˆªæ–­å…‰çº¿
    truncate_mask = train_model_functions.truncate_ray(ray)[1]
    occupancy_values_on_ray = occupancy_values_on_whole_ray[truncate_mask]
    
    # âœ… ç¡®ä¿è¿”å›çš„æ˜¯æ ‡é‡
    acc_occ = train_model_functions.accumulated_occupancy(occupancy_values_on_ray)
    
    # âœ… æ£€æŸ¥ç±»å‹
    if isinstance(acc_occ, torch.Tensor):
        occupancy_estimation[ray_id] = acc_occ.item()  # è½¬ä¸ºæ ‡é‡
    else:
        occupancy_estimation[ray_id] = acc_occ
```

------

### **ä¿®å¤ 3: æ·»åŠ è°ƒè¯•è¾“å‡º**

åœ¨ `train_loop` çš„ç¬¬ä¸€ä¸ª batch æ·»åŠ ï¼š

```python
if batch == 0:
    print("=" * 50)
    print(f"Ray shape: {rays[0].shape}")
    print(f"Occupancy values on ray shape: {occupancy_values_on_whole_ray.shape}")
    print(f"Truncated points: {truncate_mask.sum()} / {len(truncate_mask)}")
    print(f"Accumulated occupancy: {occupancy_estimation[0]}")
    print(f"Ground truth: {occupancy_values[0]}")
    print(f"Model output range: [{occupancy_values_on_whole_ray.min():.3f}, {occupancy_values_on_whole_ray.max():.3f}]")
    print("=" * 50)
```

------

### **ä¿®å¤ 4: æ£€æŸ¥å…‰çº¿æˆªæ–­**

```python
def truncate_ray(ray):
    tolerance = 1e-6
    
    # Z åæ ‡çº¦æŸ
    cond_z = (ray[:, 2] <= 0.5 + tolerance) & (ray[:, 2] >= -0.5 - tolerance)
    
    # XY åæ ‡çº¦æŸï¼ˆç®€å•çš„ç«‹æ–¹ä½“è¾¹ç•Œï¼‰
    cond_xy = (
        (ray[:, 0].abs() <= 0.5 + tolerance) & 
        (ray[:, 1].abs() <= 0.5 + tolerance)
    )
    
    valid_indexes = cond_z & cond_xy
    
    # âœ… æ·»åŠ æ–­è¨€æ£€æŸ¥
    if valid_indexes.sum() == 0:
        print(f"âš ï¸ Warning: All points filtered out! Ray range: "
              f"X=[{ray[:, 0].min():.3f}, {ray[:, 0].max():.3f}], "
              f"Y=[{ray[:, 1].min():.3f}, {ray[:, 1].max():.3f}], "
              f"Z=[{ray[:, 2].min():.3f}, {ray[:, 2].max():.3f}]")
    
    return ray[valid_indexes], valid_indexes
```

------

### **ä¿®å¤ 5: é™ä½æ­£åˆ™åŒ–æƒé‡ï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰**

åœ¨ `main.py`:

```python
loss, draw_loss, real_figure_loss = train(
    # ...
    beta_1=0.0,      # æš‚æ—¶å…³é—­æ‰€æœ‰æ­£åˆ™åŒ–
    beta_2=0.0,
    beta_3=0.0,
    beta_4=0.0,
    beta_5=0.0,
    beta_6=0.0,
    beta_eikonal=0.0,
)
```

**å…ˆæµ‹è¯• Figure Loss èƒ½å¦ä¸‹é™**ï¼

------

## ğŸ¯ é¢„æœŸçš„è°ƒè¯•ç»“æœ

ä¿®å¤åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **ç¬¬ä¸€ä¸ª epoch** çš„è°ƒè¯•è¾“å‡ºæ˜¾ç¤ºï¼š
   - å…‰çº¿é‡‡æ ·ç‚¹æ•°é‡åˆç†ï¼ˆä¾‹å¦‚ 50-80 ä¸ªç‚¹ï¼‰
   - æ¨¡å‹è¾“å‡ºä¸å…¨æ˜¯ 0.5ï¼Œè€Œæ˜¯æœ‰å˜åŒ–ï¼ˆä¾‹å¦‚ [0.3, 0.7] èŒƒå›´ï¼‰
   - `accumulated_occupancy` æ˜¯åˆç†çš„å€¼ï¼ˆä¾‹å¦‚ 0.1-0.9ï¼‰
2. **æŸå¤±æ›²çº¿**å¼€å§‹ä¸‹é™ï¼š
   - Figure Loss ä» 0.7 é™åˆ° 0.5 ä»¥ä¸‹ï¼ˆå‰ 5 ä¸ª epochï¼‰
   - Average Loss é€æ¸ä¸‹é™
3. **å¦‚æœè¿˜æ˜¯ä¸åŠ¨**ï¼Œè¯´æ˜ï¼š
   - å…‰çº¿ç”Ÿæˆæœ‰é—®é¢˜ï¼ˆé‡‡æ ·ç‚¹å…¨åœ¨è¾¹ç•Œå¤–ï¼‰
   - å­¦ä¹ ç‡è¿‡å°ï¼ˆå°è¯• `lr=1e-3`ï¼‰
   - æ•°æ®é›†æœ‰é—®é¢˜ï¼ˆå½±å­å›¾æ˜¯å¦æ­£ç¡®äºŒå€¼åŒ–ï¼Ÿï¼‰

**ç«‹å³è¿è¡Œä¿®å¤åçš„ä»£ç ï¼Œå¹¶è´´å‡ºç¬¬ä¸€ä¸ª batch çš„è°ƒè¯•è¾“å‡ºï¼**



